<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Sideline Satirist - Premium Sports Satire</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Grotesk:wght@300;400;500;600;700&family=Syncopate:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
</head>
<body>
    <div class="cursor"></div>
    <div class="cursor-follower"></div>

    <nav class="navbar">
        <div class="navbar-content">
            <a href="index.html" class="logo">
                <i class="fas fa-football-ball logo-icon"></i>
                <span class="logo-text">The Sideline Satirist</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html" class="nav-link">Latest</a></li>
                <li><a href="categories.html" class="nav-link">Categories</a></li>
                <li><a href="about.html" class="nav-link">About</a></li>
                <li><a href="#" class="subscribe-btn">Subscribe</a></li>
            </ul>
        </div>
    </nav>

    <header class="hero">
        <div class="hero-particles" id="particles"></div>
        <div class="hero-content">
            <h1 class="hero-title">Where Sports Meet Sarcasm</h1>
            <p class="hero-subtitle">Premium satirical sports coverage that's almost as reliable as instant replay</p>
        </div>
        <div class="scroll-indicator">
            <i class="fas fa-chevron-down"></i>
        </div>
    </header>

    <main>
        <section class="featured-section">
            <div class="featured-grid" id="featured-post-container"></div>
        </section>

        <section class="latest-posts">
            <div class="container">
                <h2 class="section-title">Latest Stories</h2>
                <div class="posts-grid" id="posts-grid-container"></div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>The Sideline Satirist</h3>
                    <p>Making sports funny since whenever we started doing this.</p>
                    <div class="social-links">
                        <a href="#" class="social-link" aria-label="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Facebook">
                            <i class="fab fa-facebook"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li class="footer-link"><a href="categories.html">Categories</a></li>
                        <li class="footer-link"><a href="about.html">About Us</a></li>
                        <li class="footer-link"><a href="#">Subscribe</a></li>
                        <li class="footer-link"><a href="#">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Categories</h3>
                    <ul class="footer-links">
                        <li class="footer-link"><a href="#">Football</a></li>
                        <li class="footer-link"><a href="#">Basketball</a></li>
                        <li class="footer-link"><a href="#">Baseball</a></li>
                        <li class="footer-link"><a href="#">Soccer</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 The Sideline Satirist. All rights probably reserved.</p>
            </div>
        </div>
    </footer>

  <script>
// Configuration
const config = {
    repoOwner: 'lawrence18365',
    repoName: 'sportsblog',
    postsDir: 'posts'
};

// Function to format dates consistently
function formatDate(dateString) {
    return new Date(dateString).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
}

// Function to create HTML for the featured post
function createFeaturedPost(post) {
    return `
        <article class="featured-post">
            <img src="${post.image}" alt="${post.title}">
            <div class="featured-post-content">
                <span class="category-tag">${post.category}</span>
                <h2>${post.title}</h2>
                <div class="post-meta">
                    <span><i class="far fa-calendar"></i> ${formatDate(post.date)}</span>
                    <span><i class="far fa-user"></i> By ${post.author}</span>
                </div>
                <p>${post.excerpt}</p>
                <a href="${post.path}" class="read-more">Read Full Story →</a>
            </div>
        </article>
    `;
}

// Function to create HTML for a regular post card
function createPostCard(post) {
    return `
        <article class="post-card">
            <img src="${post.image}" alt="${post.title}">
            <div class="post-content">
                <span class="category-tag">${post.category}</span>
                <h3>${post.title}</h3>
                <div class="post-meta">
                    <span>${formatDate(post.date)}</span>
                </div>
                <p>${post.excerpt}</p>
                <a href="${post.path}" class="read-more">Read More →</a>
            </div>
        </article>
    `;
}

// Function to fetch and parse posts from GitHub
async function getPosts() {
    try {
        const apiUrl = `https://api.github.com/repos/${config.repoOwner}/${config.repoName}/contents/${config.postsDir}`;
        console.log('Fetching from URL:', apiUrl);
        
        const response = await fetch(apiUrl);
        console.log('API Response status:', response.status);
        
        if (!response.ok) {
            const errorText = await response.text();
            console.error('GitHub API error details:', errorText);
            throw new Error(`GitHub API error: ${response.status}`);
        }

        const data = await response.json();
        console.log('Files found in directory:', data.map(file => file.name));

        const postsWithMetadata = await Promise.all(data.map(async (post) => {
            try {
                const postUrl = post.download_url;
                const postResponse = await fetch(postUrl);
                
                if (!postResponse.ok) {
                    console.error(`Error fetching post ${post.name}:`, postResponse.status);
                    return null;
                }
                
                const postContent = await postResponse.text();

                // Extract front matter
                const frontMatterMatch = postContent.match(/^---([\s\S]*?)---/);
                if (!frontMatterMatch) {
                    console.warn(`No front matter found in ${post.name}`);
                    return null;
                }

                console.log(`Front matter found in ${post.name}:`, frontMatterMatch[1]);
                const frontMatter = jsyaml.load(frontMatterMatch[1]);

                return { 
                    ...post, 
                    ...frontMatter,
                    title: frontMatter.title || 'Untitled Post',
                    excerpt: frontMatter.excerpt || 'No excerpt available',
                    date: frontMatter.date || new Date().toISOString(),
                    author: frontMatter.author || 'Anonymous',
                    category: frontMatter.category || 'Uncategorized',
                    image: frontMatter.image || '/placeholder.svg?height=400&width=600',
                    path: `${config.postsDir}/${post.name}`
                };
            } catch (error) {
                console.error(`Error processing post ${post.name}:`, error);
                return null;
            }
        }));

        const validPosts = postsWithMetadata.filter(post => post !== null);
        console.log('Valid posts processed:', validPosts.length);
        return validPosts.sort((a, b) => new Date(b.date) - new Date(a.date));

    } catch (error) {
        console.error('Error in getPosts:', error);
        throw error;
    }
}

// Function to initialize the blog
// Function to initialize the blog
async function initializeBlog() {
    const postsGridContainer = document.getElementById('posts-grid-container');
    const featuredPostContainer = document.getElementById('featured-post-container');

    // Show loading states
    if (featuredPostContainer) {
        featuredPostContainer.innerHTML = '<div class="loading">Loading featured post...</div>';
    }
    if (postsGridContainer) {
        postsGridContainer.innerHTML = '<div class="loading">Loading posts...</div>';
    }

    try {
        console.log('Starting blog initialization...');
        const posts = await getPosts();
        console.log('Posts retrieved:', posts);

        if (!posts || posts.length === 0) {
            throw new Error('No posts found');
        }

        // Find featured post or use the first post
        const featuredPost = posts.find(post => post.featured) || posts[0];
        if (featuredPost && featuredPostContainer) {
            // Create and assign the featured post HTML to the container
            featuredPostContainer.innerHTML = createFeaturedPost(featuredPost);
            console.log('Featured post loaded:', featuredPost.title);
        }

        // Get non-featured posts
        const regularPosts = posts
            .filter(post => post !== featuredPost)
            .sort((a, b) => new Date(b.date) - new Date(a.date));

        // Update posts grid
        if (postsGridContainer) {
            postsGridContainer.innerHTML = regularPosts.length > 0 
                ? regularPosts.map(post => createPostCard(post)).join('')
                : '<p>No posts found.</p>';
            console.log('Regular posts loaded:', regularPosts.length);
        }

    } catch (error) {
        console.error('Error initializing blog:', error);
        
        if (featuredPostContainer) {
            featuredPostContainer.innerHTML = `<div class="error">Error loading featured post: ${error.message}</div>`;
        }
        if (postsGridContainer) {
            postsGridContainer.innerHTML = `<div class="error">Error loading posts: ${error.message}</div>`;
        }
    }
}

// Add required styles
const styles = document.createElement('style');
styles.textContent = `
    .loading {
        text-align: center;
        padding: 2rem;
        color: var(--color-accent);
        font-size: 1.2rem;
    }

    .error {
        text-align: center;
        padding: 2rem;
        color: #ff3c00;
        font-size: 1.2rem;
    }
`;
document.head.appendChild(styles);

// Run initialization when DOM is loaded
document.addEventListener('DOMContentLoaded', initializeBlog);
</script>
</body>
</html>
