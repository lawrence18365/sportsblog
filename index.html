<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Sideline Satirist - Premium Sports Satire</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Grotesk:wght@300;400;500;600;700&family=Syncopate:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
</head>
<body>
    <div class="cursor"></div>
    <div class="cursor-follower"></div>

    <nav class="navbar">
        <div class="navbar-content">
            <a href="index.html" class="logo">
                <i class="fas fa-football-ball logo-icon"></i>
                <span class="logo-text">The Sideline Satirist</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html" class="nav-link">Latest</a></li>
                <li><a href="categories.html" class="nav-link">Categories</a></li>
                <li><a href="about.html" class="nav-link">About</a></li>
                <li><a href="#" class="subscribe-btn">Subscribe</a></li>
            </ul>
        </div>
    </nav>

    <header class="hero">
        <div class="hero-particles" id="particles"></div>
        <div class="hero-content">
            <h1 class="hero-title">Where Sports Meet Sarcasm</h1>
            <p class="hero-subtitle">Premium satirical sports coverage that's almost as reliable as instant replay</p>
        </div>
        <div class="scroll-indicator">
            <i class="fas fa-chevron-down"></i>
        </div>
    </header>

    <main>
        <section class="featured-section">
            <div class="featured-grid" id="featured-post-container"></div>
        </section>

        <section class="latest-posts">
            <div class="container">
                <h2 class="section-title">Latest Stories</h2>
                <div class="posts-grid" id="posts-grid-container"></div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>The Sideline Satirist</h3>
                    <p>Making sports funny since whenever we started doing this.</p>
                    <div class="social-links">
                        <a href="#" class="social-link" aria-label="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Facebook">
                            <i class="fab fa-facebook"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li class="footer-link"><a href="categories.html">Categories</a></li>
                        <li class="footer-link"><a href="about.html">About Us</a></li>
                        <li class="footer-link"><a href="#">Subscribe</a></li>
                        <li class="footer-link"><a href="#">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Categories</h3>
                    <ul class="footer-links">
                        <li class="footer-link"><a href="#">Football</a></li>
                        <li class="footer-link"><a href="#">Basketball</a></li>
                        <li class="footer-link"><a href="#">Baseball</a></li>
                        <li class="footer-link"><a href="#">Soccer</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 The Sideline Satirist. All rights probably reserved.</p>
            </div>
        </div>
    </footer>

  <script>
    // Function to format dates consistently
    function formatDate(dateString) {
        return new Date(dateString).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    }

    // Function to create HTML for the featured post
    function createFeaturedPost(post) {
        const featuredContainer = document.getElementById('featured-post-container');
        if (!featuredContainer) {
            console.error('Featured post container not found');
            return;
        }

        featuredContainer.innerHTML = `
            <article class="featured-post">
                <img src="${post.image}" alt="${post.title}">
                <div class="featured-post-content">
                    <span class="category-tag">${post.category}</span>
                    <h2>${post.title}</h2>
                    <div class="post-meta">
                        <span>${formatDate(post.date)}</span> | 
                        <span>By ${post.author}</span>
                    </div>
                    <p>${post.excerpt}</p>
                    <a href="${post.path}" class="read-more">Read Full Story →</a>
                </div>
            </article>
        `;
    }

    // Function to create HTML for a regular post card
    function createPostCard(post) {
        return `
            <article class="post-card">
                <img src="${post.image}" alt="${post.title}">
                <div class="post-content">
                    <span class="category-tag">${post.category}</span>
                    <h3>${post.title}</h3>
                    <div class="post-meta">
                        <span>${formatDate(post.date)}</span>
                    </div>
                    <p>${post.excerpt}</p>
                    <a href="${post.path}" class="read-more">Read More →</a>
                </div>
            </article>
        `;
    }

    // Function to initialize the blog
    async function initializeBlog() {
        const repoOwner = 'lawrence18365';
        const repoName = 'sportsblog';
        const postsDir = 'posts';

        // Get container elements
        const postsGridContainer = document.getElementById('posts-grid-container');
        const featuredPostContainer = document.getElementById('featured-post-container');

        // Show loading states
        if (featuredPostContainer) {
            featuredPostContainer.innerHTML = '<div class="loading">Loading featured post...</div>';
        }
        if (postsGridContainer) {
            postsGridContainer.innerHTML = '<div class="loading">Loading posts...</div>';
        }

        try {
            const posts = await getPosts(repoOwner, repoName, postsDir);
            console.log('Fetched posts:', posts); // Debug log

            if (!posts || posts.length === 0) {
                throw new Error('No posts found');
            }

            // Find featured post or use the first post
            const featuredPost = posts.find(post => post.featured) || posts[0];
            if (featuredPost) {
                createFeaturedPost(featuredPost);
            }

            // Get non-featured posts and sort by date
            const regularPosts = posts
                .filter(post => post !== featuredPost)
                .sort((a, b) => new Date(b.date) - new Date(a.date));

            // Update posts grid
            if (postsGridContainer) {
                postsGridContainer.innerHTML = regularPosts.length > 0 
                    ? regularPosts.map(post => createPostCard(post)).join('')
                    : '<p>No posts found.</p>';
            }

        } catch (error) {
            console.error('Error initializing blog:', error);
            
            if (featuredPostContainer) {
                featuredPostContainer.innerHTML = '<div class="error">Error loading featured post.</div>';
            }
            if (postsGridContainer) {
                postsGridContainer.innerHTML = '<div class="error">Error loading posts.</div>';
            }
        }
    }

    // Function to fetch and parse posts from GitHub
  // Debug version of getPosts function
async function getPosts(repoOwner, repoName, postsDir) {
    const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${postsDir}`;
    console.log('Fetching from URL:', apiUrl);

    try {
        const response = await fetch(apiUrl);
        console.log('API Response status:', response.status);
        
        if (!response.ok) {
            const errorText = await response.text();
            console.error('GitHub API error details:', errorText);
            throw new Error(`GitHub API error: ${response.status}`);
        }

        const data = await response.json();
        console.log('Files found in directory:', data.map(file => file.name));

        // Filter for both Markdown and HTML files
        const posts = await Promise.all(data
            .filter(file => file.name.endsWith('.md') || file.name.endsWith('.html'))
            .map(async (file) => {
                console.log('Processing file:', file.name);
                try {
                    const postResponse = await fetch(file.download_url);
                    if (!postResponse.ok) {
                        console.error(`Error fetching post ${file.name}:`, postResponse.status);
                        return null;
                    }
                    const postContent = await postResponse.text();
                    
                    // Extract front matter
                    const frontMatterMatch = postContent.match(/^---\n([\s\S]*?)\n---/);
                    if (!frontMatterMatch) {
                        console.warn(`No front matter found in ${file.name}`);
                        return null;
                    }
                    
                    console.log(`Front matter found in ${file.name}:`, frontMatterMatch[1]);
                    const frontMatter = jsyaml.load(frontMatterMatch[1]);

                    return {
                        ...file,
                        ...frontMatter,
                        title: frontMatter.title || 'Untitled Post',
                        excerpt: frontMatter.excerpt || 'No excerpt available',
                        date: frontMatter.date || new Date().toISOString(),
                        author: frontMatter.author || 'Anonymous',
                        category: frontMatter.category || 'Uncategorized',
                        image: frontMatter.image || 'placeholder.svg',
                        content: postContent.replace(/^---\n[\s\S]*?\n---/, '').trim() // Remove front matter
                    };
                } catch (error) {
                    console.error(`Error processing ${file.name}:`, error);
                    return null;
                }
            }));

        const validPosts = posts.filter(post => post !== null);
        console.log('Valid posts found:', validPosts.length);
        
        return validPosts.sort((a, b) => new Date(b.date) - new Date(a.date));

    } catch (error) {
        console.error('Error in getPosts:', error);
        throw error;
    }
}

// Modified initialize function
async function initializeBlog() {
    const featuredPostContainer = document.getElementById('featured-post-container');
    const postsGridContainer = document.getElementById('posts-grid-container');

    featuredPostContainer.innerHTML = '<div class="loading">Loading Featured Post...</div>';
    postsGridContainer.innerHTML = '<div class="loading">Loading Posts...</div>';

    try {
        console.log('Starting blog initialization...');
        const posts = await getPosts(repoOwner, repoName, postsDir);
        console.log('Posts retrieved:', posts);

        if (posts.length === 0) {
            console.error('No posts found');
            featuredPostContainer.innerHTML = '<div class="error">No posts available.</div>';
            postsGridContainer.innerHTML = '<div class="error">No posts available.</div>';
            return;
        }

        // Featured post
        const featuredPostData = posts.find(post => post.featured) || posts[0];
        console.log('Featured post:', featuredPostData);
        featuredPostContainer.innerHTML = createFeaturedPost(featuredPostData);

        // Regular posts
        const regularPosts = posts.filter(post => post !== featuredPostData);
        console.log('Regular posts:', regularPosts.length);
        postsGridContainer.innerHTML = regularPosts.map(createPostCard).join('');

    } catch (error) {
        console.error('Error initializing blog:', error);
        featuredPostContainer.innerHTML = `<div class="error">Error loading featured post: ${error.message}</div>`;
        postsGridContainer.innerHTML = `<div class="error">Error loading posts: ${error.message}</div>`;
    }
}

    // Run initialization when DOM is loaded
    document.addEventListener('DOMContentLoaded', initializeBlog);
    </script>

    <style>
    .loading {
        text-align: center;
        padding: 2rem;
        color: var(--color-accent);
        font-size: 1.2rem;
    }

    .error {
        text-align: center;
        padding: 2rem;
        color: #ff3c00;
        font-size: 1.2rem;
    }
    </style>
</body>
</html>
